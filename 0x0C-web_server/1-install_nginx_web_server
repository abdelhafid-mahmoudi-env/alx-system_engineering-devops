#!/usr/bin/env bash
# This script installs Nginx web server and configures it to meet the requirements

# Install Nginx
apt-get update
apt-get install -y nginx

# Ensure Nginx is listening on port 80
sed -i 's/^\(.*listen .*:\)80\(.*\)$/\180\2/' /etc/nginx/sites-available/default

# Restart Nginx without using systemctl
nginx -s reload

# Create a default index.html file
echo "Hello World!" > /var/www/html/index.html

# Ensure Nginx returns "Hello World!" when queried at root
nginx_response=$(curl -s http://localhost)
if [[ "$nginx_response" != *"Hello World!"* ]]; then
    echo "Error: Nginx is not returning the expected response."
    exit 1
fi

echo "Nginx installed and configured successfully."
